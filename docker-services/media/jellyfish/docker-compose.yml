# ----------------------------
# Docker Compose file for Docker Services - Homelab Web
# Services: Jellyfin
# ----------------------------

services:
  # ----------------------------
  # JELLYFIN (HOST NETWORK)
  # ----------------------------
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    runtime: nvidia
    restart: unless-stopped
    networks:
      - proxy_net
    expose:
      - "8096" # Expose port for initial setup (can remove later)
    ports:
      - "8096:8096"
    volumes:
      - /srv/docker-data/jellyfin/config:/config
      - /srv/docker-data/jellyfin/cache:/cache
      - /mnt/media/Entertainment/Movies:/media/movies:ro
      - /mnt/media/Entertainment/Shows:/media/tvshows:ro
      - /mnt/media/Music:/media/music:ro
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Kolkata
      - JELLYFIN_PublishedServerUrl=http://192.168.29.197:8096
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all 
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu, video, utility]
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

networks:
  proxy_net:
    external: true

# ============================================
# INSTRUCTIONS FOR ADDING MEDIA LATER:
# ============================================
#
# When you're ready to add media:
# 1. Stop Jellyfin: docker-compose down
# 2. Edit this file and uncomment/add volume mounts
# 3. Restart: docker-compose up -d
# 4. In Jellyfin web UI: Dashboard → Libraries → Add Library
# 5. Point to /media/movies, /media/tvshows, etc.
# 6. Scan library
#
# You can add/remove media paths anytime without losing:
# - User accounts
# - Watch history
# - Settings
# - Metadata (as long as /config volume persists)
# ============================================
